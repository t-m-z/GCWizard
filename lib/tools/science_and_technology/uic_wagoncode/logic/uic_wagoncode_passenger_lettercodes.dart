const Map<String, String> _UICWagenCodesPassengerLetterCodesCategories = {
  'A': 'uic_passenger_letters_category_a',
  'B': 'uic_passenger_letters_category_b',
  'AB': 'uic_passenger_letters_category_ab',
  'AR': 'uic_passenger_letters_category_ar',
  'BR': 'uic_passenger_letters_category_br',
  'AD': 'uic_passenger_letters_category_ad',
  'BD': 'uic_passenger_letters_category_bd',
  'D' :'uic_passenger_letters_category_d',
  'DD': 'uic_passenger_letters_category_dd',
  'S': 'uic_passenger_letters_category_s',
  'Salon':'uic_passenger_letters_category_salon',
  'SR': 'uic_passenger_letters_category_sr',
  'WLA': 'uic_passenger_letters_categorywla',
  'WLB': 'uic_passenger_letters_category_wlb',
  'WLAB': 'uic_passenger_letters_category_wlab',
  'WR': 'uic_passenger_letters_category_wr',
  'KA': 'uic_passenger_letters_category_ka',
  'KB': 'uic_passenger_letters_category_kb' ,
  'KD': 'uic_passenger_letters_category_kd',
  'Z': 'uic_passenger_letters_category_z',
};

const Map<String, Map<String, String>> _UICWagenCodesPassengeCategoriesCountries = {
  '50': {
    'DD': 'uic_passenger_letters_category_50_dd',
  },
  '74': {
    'F': 'uic_passenger_letters_category_74_f',
    'R': 'uic_passenger_letters_category_74_r',
  },
  '76': {
    'FR': 'uic_passenger_letters_category_76_fr',
  },
  '80': {
    'DA': 'uic_passenger_letters_category_80_da',
    'DB': 'uic_passenger_letters_category_80_db',
    'DAB':'uic_passenger_letters_category_80_dab',
    'Post': 'uic_passenger_letters_category_80_post',
    'BPost': 'uic_passenger_letters_category_80_bpost',
    'DPost': 'uic_passenger_letters_category_80_dpost',
    'WG': 'uic_passenger_letters_category_80_wg' ,
    'WGS': 'uic_passenger_letters_category_80_wgs' ,
  },
  '81': {
    'F': 'uic_passenger_letters_category_81_f',
    'Post': 'uic_passenger_letters_category_81_post',
  },
  '85': {
    'S': 'uic_passenger_letters_category_85_s',
    'Z': 'uic_passenger_letters_category_85_z',
  }
};

const Map<String, Map<String, String>> _UICWagenCodesPassengerLetterCodesClassifications = {
  '50': {
    'b': 'uic_passenger_letters_classification_dr_b',
    'f': 'uic_passenger_letters_classification_dr_f',
    'tr': 'uic_passenger_letters_classification_dr_tr',
    'v': 'uic_passenger_letters_classification_dr_v',
    'w': 'uic_passenger_letters_classification_dr_w',
    'z': 'uic_passenger_letters_classification_dr_z',
  },
  '80': {
    'a': 'uic_passenger_letters_classification_db_a',
    'aa': 'uic_passenger_letters_classification_db_aa',
    'b': 'uic_passenger_letters_classification_db_b',
    'c': 'uic_passenger_letters_classification_db_c',
    'd': 'uic_passenger_letters_classification_db_d',
    'e': 'uic_passenger_letters_classification_db_e',
    'ee': 'uic_passenger_letters_classification_db_ee',
    'f': 'uic_passenger_letters_classification_db_f',
    'g': 'uic_passenger_letters_classification_db_g',
    'h': 'uic_passenger_letters_classification_db_h',
    'i': 'uic_passenger_letters_classification_db_i',
    'k': 'uic_passenger_letters_classification_db_k',
    'l': 'uic_passenger_letters_classification_db_l',
    'm': 'uic_passenger_letters_classification_db_m',
    'mm': 'uic_passenger_letters_classification_db_mm',
    'n': 'uic_passenger_letters_classification_db_n',
    'o': 'uic_passenger_letters_classification_db_o',
    'p': 'uic_passenger_letters_classification_db_p',
    'q': 'uic_passenger_letters_classification_db_q',
    'r': 'uic_passenger_letters_classification_db_r',
    's': 'uic_passenger_letters_classification_db_s',
    'u': 'uic_passenger_letters_classification_db_u',
    'uu': 'uic_passenger_letters_classification_db_uu',
    'v': 'uic_passenger_letters_classification_db_v',
    'w': 'uic_passenger_letters_classification_db_w',
    'x': 'uic_passenger_letters_classification_db_x',
    'y': 'uic_passenger_letters_classification_db_y',
    'z': 'uic_passenger_letters_classification_db_z',
  },
  '81': {
    'b': 'uic_passenger_letters_classification_oebb_b',
    'c': 'uic_passenger_letters_classification_oebb_c',
    'e': 'uic_passenger_letters_classification_oebb_e',
    'f': 'uic_passenger_letters_classification_oebb_f',
    'h': 'uic_passenger_letters_classification_oebb_h',
    'i': 'uic_passenger_letters_classification_oebb_i',
    'ip': 'uic_passenger_letters_classification_oebb_ip',
    'l': 'uic_passenger_letters_classification_oebb_l',
    'm': 'uic_passenger_letters_classification_oebb_m',
    'o': 'uic_passenger_letters_classification_oebb_o',
    'p': 'uic_passenger_letters_classification_oebb_p',
    's': 'uic_passenger_letters_classification_oebb_s',
    '端': 'uic_passenger_letters_classification_oebb_端',
    'v': 'uic_passenger_letters_classification_oebb_v',
    'w': 'uic_passenger_letters_classification_oebb_w',
    'x': 'uic_passenger_letters_classification_oebb_x',
    'y': 'uic_passenger_letters_classification_oebb_y',
    'z': 'uic_passenger_letters_classification_oebb_z',
    '-dl': 'uic_passenger_letters_classification_oebb_-dl',
    '-ds': 'uic_passenger_letters_classification_oebb_-ds',
    '-k': 'uic_passenger_letters_classification_oebb_-k',
    '-l': 'uic_passenger_letters_classification_oebb_-l',
    '-s': 'uic_passenger_letters_classification_oebb_-s',
    '/s': 'uic_passenger_letters_classification_oebb_/s',
    '/sz': 'uic_passenger_letters_classification_oebb_/sz',
    'T': 'uic_passenger_letters_classification_oebb_t',
    'ET': 'uic_passenger_letters_classification_oebb_et',
    'ES': 'uic_passenger_letters_classification_oebb_es',
    'VT': 'uic_passenger_letters_classification_oebb_vt',
    'VS': 'uic_passenger_letters_classification_oebb_vs',
  },
  '85': {
    'b': 'uic_passenger_letters_classification_85_b',
    'c': 'uic_passenger_letters_classification_85_c',
    'i': 'uic_passenger_letters_classification_85_i',
    'm': 'uic_passenger_letters_classification_85_m',
    'p': 'uic_passenger_letters_classification_85_p',
    'r': 'uic_passenger_letters_classification_85_r',
    's': 'uic_passenger_letters_classification_85_s',
    't': 'uic_passenger_letters_classification_85_t',
    '端': 'uic_passenger_letters_classification_85_端',
  }
};

Map<String, String> uicPassengerWagonLetterCodes(String countryCode, String letters) {
  if (letters.isEmpty) {
    return <String, String>{};
  }

  var categories = Map<String, String>.from(_UICWagenCodesPassengerLetterCodesCategories);

  if (_UICWagenCodesPassengeCategoriesCountries.containsKey(countryCode)) {
    if (countryCode == '50') {
      categories.addAll(_UICWagenCodesPassengeCategoriesCountries['80']!);
    }
    categories.addAll(_UICWagenCodesPassengeCategoriesCountries[countryCode]!);
  }

  var categoryKeys = List<String>.from(categories.keys);
  categoryKeys.sort((a, b) => b.length.compareTo(a.length));

  var out = <String, String>{};

  for (int i = 0; i < categoryKeys.length; i++) {
    var key = categoryKeys[i];
    if (letters.startsWith(key)) {
      out.putIfAbsent(key, () => categories[key]!);
      letters = letters.substring(key.length);
      break;
    }
  }

  var classifications = <String, String>{};
  var _letters = letters;
  var _letterHyphens = '';
  var _letterSlashes = '';

  if (_UICWagenCodesPassengerLetterCodesClassifications.containsKey(countryCode)) {
    if (countryCode == '50') {
      classifications.addAll(_UICWagenCodesPassengerLetterCodesClassifications['80']!);
    }
    classifications.addAll(_UICWagenCodesPassengerLetterCodesClassifications[countryCode]!);

    if (countryCode == '81') {
      var _lettersParts = _letters.split('-');
      if (_lettersParts.length > 1) {
        _letters = _lettersParts[0];
        _letterHyphens = _lettersParts[1];

        _lettersParts = _letterHyphens.split('/');
        if (_lettersParts.length > 1) {
          _letterHyphens = _lettersParts[0];
          _letterSlashes = _lettersParts[1];
        }
      }
      _lettersParts = _letters.split('/');
      if (_lettersParts.length > 1) {
        _letters = _lettersParts[0];
        _letterSlashes = _lettersParts[1];

        _lettersParts = _letterSlashes.split('-');
        if (_lettersParts.length > 1) {
          _letterSlashes = _lettersParts[0];
          _letterHyphens = _lettersParts[1];
        }
      }
    }
  }

  var classificationKeys = List<String>.from(classifications.keys);
  classificationKeys.sort((a, b) => b.length.compareTo(a.length));

  var _classificationKeysHyphens = List<String>.from(classificationKeys.where((element) => element.startsWith('-')).map((e) => e.substring(1)));
  var _classificationKeysSlashes = List<String>.from(classificationKeys.where((element) => element.startsWith('/')).map((e) => e.substring(1)));
  classificationKeys.removeWhere((element) => element.startsWith('-') || element.startsWith('/'));

  void _translateLetterCodes(String letterCodes, List<String> keys, Map<String, String> classificationMap, String prefix, Map<String, String> output) {
    var i = 0;
    while (i < keys.length && letterCodes.isNotEmpty) {
      var key = keys[i];
      if (letterCodes.startsWith(key)) {
        output.putIfAbsent(prefix + key, () => classificationMap[prefix + key]!);
        letterCodes = letterCodes.substring(key.length);
        i = 0;
      } else {
        i++;
        if (i == keys.length) {
          i = 0;
          letterCodes = letterCodes.substring(1);
        }
      }
    }
  }

  _translateLetterCodes(_letters, classificationKeys, classifications, '', out);
  _translateLetterCodes(_letterHyphens, _classificationKeysHyphens, classifications, '-', out);
  _translateLetterCodes(_letterSlashes, _classificationKeysSlashes, classifications, '/', out);

  return out;
}